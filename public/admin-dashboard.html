<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - JobsArena</title>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; }
    .list-item { padding:8px; border-bottom:1px solid #ddd; }
    .list { margin-bottom:20px; }
  </style>
</head>
<body>
  <h1>Admin Dashboard</h1>

  <h2>Jobs</h2>
  <div id="jobsList" class="list"></div>

  <h2>Members</h2>
  <div id="membersList" class="list"></div>

  <h2>Offers</h2>
  <div id="offersList" class="list"></div>

  <h2>Popups</h2>
  <div id="popupList" class="list"></div>

  <script>
    // ✅ Dynamic API base
    const API_BASE = window.location.hostname === "localhost"
      ? "http://localhost:5000"
      : "https://jobsarena.onrender.com";

    // ===== Admin guard =====
    const session = JSON.parse(localStorage.getItem("jb_session") || "null");
    if (!session || !session.user || session.user.role !== "admin") {
      alert("Admin only — please login as admin");
      window.location = "login.html";
    }
    const token = session.token;

    // ===== DOM Elements =====
    const jobsList = document.getElementById("jobsList");
    const membersList = document.getElementById("membersList");
    const offersList = document.getElementById("offersList");
    const popupList = document.getElementById("popupList");

    // Helper fetch wrapper
    async function apiFetch(endpoint, options = {}) {
      const res = await fetch(`${API_BASE}/api/${endpoint}`, {
        ...options,
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`,
          ...(options.headers || {})
        }
      });
      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.message || `Request failed (${res.status})`);
      }
      return res.json();
    }

    // ===== Render Data =====
    async function renderJobs() {
      try {
        const jobs = await apiFetch("jobs");
        jobsList.innerHTML = jobs.map(j =>
          `<div class="list-item"><span>${j.title} @ ${j.company}</span></div>`
        ).join("") || "<p style='color:gray'>No jobs yet.</p>";
      } catch (err) {
        console.error("Render jobs error:", err);
        jobsList.innerHTML = "<p style='color:red'>Error loading jobs</p>";
      }
    }
    async function renderMembers() {
      try {
        const members = await apiFetch("members");
        membersList.innerHTML = members.map(m =>
          `<div class="list-item"><span>${m.name} (${m.role})</span></div>`
        ).join("") || "<p style='color:gray'>No members yet.</p>";
      } catch (err) {
        console.error("Render members error:", err);
        membersList.innerHTML = "<p style='color:red'>Error loading members</p>";
      }
    }
    async function renderOffers() {
      try {
        const offers = await apiFetch("offers");
        offersList.innerHTML = offers.map(o =>
          `<div class="list-item"><span>${o.title} — $${o.price}</span></div>`
        ).join("") || "<p style='color:gray'>No offers yet.</p>";
      } catch (err) {
        console.error("Render offers error:", err);
        offersList.innerHTML = "<p style='color:red'>Error loading offers</p>";
      }
    }
    async function renderPopups() {
      try {
        const popups = await apiFetch("popups");
        popupList.innerHTML = popups.map(p =>
          `<div class="list-item"><span>${p.text} ${p.enabled?'✅':''}</span></div>`
        ).join("") || "<p style='color:gray'>No popups yet.</p>";
      } catch (err) {
        console.error("Render popups error:", err);
        popupList.innerHTML = "<p style='color:red'>Error loading popups</p>";
      }
    }

    // ===== Init =====
    renderJobs();
    renderMembers();
    renderOffers();
    renderPopups();
  </script>
</body>
</html>








