<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin — JobBoard</title>
<style>
  :root{--accent:#0ea5a4;--muted:#6b7280}
  *{box-sizing:border-box} 
  body{font-family:Inter,Arial;background:#f6f8fb;margin:0;color:#0f172a}
  .top{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:#fff;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
  .wrap{max-width:1100px;margin:18px auto;padding:10px}
  .cols{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .card{background:#fff;padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.06);margin-bottom:16px}
  input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #eef6f5;margin-top:8px}
  .btn{padding:8px 12px;border-radius:8px;background:var(--accent);color:#fff;border:none;margin-top:8px;cursor:pointer}
  .danger{background:#ef4444}
  .list-item{display:flex;justify-content:space-between;align-items:center;background:#f9fafb;padding:8px;border-radius:8px;margin-top:6px}
  .list-item span{flex:1;margin-right:10px}
  .actions button{margin-left:6px}
  @media(max-width:900px){.cols{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="top">
  <div style="font-weight:800;color:var(--accent)">Admin Dashboard</div>
  <div><a href="index.html">View site</a></div>
</div>
<div class="wrap">
  <div class="cols">
    <!-- Add Job -->
    <div class="card">
      <h3>Add Job</h3>
      <form id="jobForm">
        <label>Title<input id="jt" required /></label>
        <label>Company<input id="jc" required /></label>
        <label>Category<select id="jcat">
          <option>Housekeeping</option>
          <option>Mechanics</option>
          <option>Medical</option>
          <option>Engineering</option>
        </select></label>
        <label>Location<input id="jloc" /></label>
        <label>Description<textarea id="jdesc"></textarea></label>
        <button class="btn" type="submit">Add Job</button>
      </form>
    </div>

    <!-- Add Member / Offer -->
    <div class="card">
      <h3>Add Member</h3>
      <form id="memberForm">
        <label>Name<input id="mname" required /></label>
        <label>Role<input id="mrole" placeholder="example: recruiter"/></label>
        <button class="btn" type="submit">Add Member</button>
      </form>

      <hr style="margin:12px 0"/>

      <h3>Add Offer</h3>
      <form id="offerForm">
        <label>Title<input id="ot" required /></label>
        <label>Price<input id="op" required /></label>
        <label>Description<textarea id="od"></textarea></label>
        <button class="btn" type="submit">Add Offer</button>
      </form>
    </div>
  </div>

  <!-- Popup Manager -->
  <div class="card">
    <h3>Manage Popups</h3>
    <form id="popupForm">
      <label>Popup Text<textarea id="popupText" required placeholder="e.g. Night Offer: Join now at 30% off"></textarea></label>
      <label style="display:block;margin-top:8px"><input type="checkbox" id="popupEnabled" /> Enable popup</label>
      <button class="btn" type="submit">Add Popup</button>
    </form>
    <h4 style="margin-top:14px">Existing Popups</h4>
    <div id="popupList"></div>
  </div>
</div>

<script>
const API_BASE = "http://localhost:5000";

// ===== Admin guard =====
const session = JSON.parse(localStorage.getItem("jb_session") || "null");
if (!session || !session.user || session.user.role !== "admin") {
  alert("Admin only — please login as admin");
  window.location = "login.html";
}
const token = session.token;

// ===== Add Job =====
document.getElementById("jobForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const title = document.getElementById("jt").value.trim();
  const company = document.getElementById("jc").value.trim();
  const category = document.getElementById("jcat").value;
  const location = document.getElementById("jloc").value.trim();
  const description = document.getElementById("jdesc").value.trim();

  try {
    const res = await fetch(`${API_BASE}/api/jobs`, {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
      body: JSON.stringify({ title, company, category, location, description })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to add job");
    alert("✅ Job added successfully");
    e.target.reset();
  } catch (err) { alert("❌ " + err.message); }
});

// ===== Add Member =====
document.getElementById("memberForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = document.getElementById("mname").value.trim();
  const role = document.getElementById("mrole").value.trim();
  try {
    const res = await fetch(`${API_BASE}/api/members`, {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
      body: JSON.stringify({ name, role })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to add member");
    alert("✅ Member added successfully"); e.target.reset();
  } catch (err) { alert("❌ " + err.message); }
});

// ===== Add Offer =====
document.getElementById("offerForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const title = document.getElementById("ot").value.trim();
  const price = document.getElementById("op").value.trim();
  const description = document.getElementById("od").value.trim();
  try {
    const res = await fetch(`${API_BASE}/api/offers`, {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
      body: JSON.stringify({ title, price, description })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to add offer");
    alert("✅ Offer added successfully"); e.target.reset();
  } catch (err) { alert("❌ " + err.message); }
});

// ===== Add Popup =====
const popupForm = document.getElementById("popupForm");
const popupList = document.getElementById("popupList");

async function renderPopups() {
  try {
    const res = await fetch(`${API_BASE}/api/popups`);
    const popups = await res.json();
    popupList.innerHTML = "";
    if (!popups.length) { popupList.innerHTML = "<p style='color:var(--muted)'>No popups yet.</p>"; return; }
    popups.forEach(p => {
      const div = document.createElement("div");
      div.className = "list-item";
      div.innerHTML = `<span>${p.text} ${p.enabled?'✅':''}</span>
        <div class="actions">
          <button class="btn" onclick="editPopup(${p.id})">Edit</button>
          <button class="btn danger" onclick="deletePopup(${p.id})">Delete</button>
        </div>`;
      popupList.appendChild(div);
    });
  } catch (err) { console.error(err); }
}
popupForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const text = document.getElementById("popupText").value.trim();
  const enabled = document.getElementById("popupEnabled").checked;
  try {
    const res = await fetch(`${API_BASE}/api/popups`, {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
      body: JSON.stringify({ text, enabled })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to add popup");
    alert("✅ Popup added"); popupForm.reset(); renderPopups();
  } catch (err) { alert("❌ " + err.message); }
});

// Initial render
renderPopups();
</script>
</body>
</html>



