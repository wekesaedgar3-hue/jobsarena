<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - JobsArena</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h2 { margin-top: 40px; }
    form { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    input, textarea, select { display: block; width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #ccc; border-radius: 4px; }
    button { background: #007bff; color: #fff; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .list-item { padding: 6px 10px; border-bottom: 1px solid #ddd; }
  </style>
</head>
<body>
  <h1>Admin Dashboard</h1>

  <!-- ===== Jobs ===== -->
  <h2>Add Job</h2>
  <form id="jobForm">
    <input id="jt" placeholder="Job Title" required>
    <input id="jc" placeholder="Company" required>
    <input id="jcat" placeholder="Category" required>
    <input id="jloc" placeholder="Location" required>
    <textarea id="jdesc" placeholder="Description"></textarea>
    <button type="submit">Add Job</button>
  </form>
  <h3>Available Jobs</h3>
  <div id="jobsList"></div>

  <!-- ===== Members ===== -->
  <h2>Add Member</h2>
  <form id="memberForm">
    <input id="mname" placeholder="Member Name" required>
    <input id="mrole" placeholder="Role" required>
    <button type="submit">Add Member</button>
  </form>
  <h3>Members</h3>
  <div id="membersList"></div>

  <!-- ===== Offers ===== -->
  <h2>Add Offer</h2>
  <form id="offerForm">
    <input id="ot" placeholder="Offer Title" required>
    <input id="op" placeholder="Price" required>
    <textarea id="od" placeholder="Description"></textarea>
    <button type="submit">Add Offer</button>
  </form>
  <h3>Offers</h3>
  <div id="offersList"></div>

  <!-- ===== Popups ===== -->
  <h2>Add Popup</h2>
  <form id="popupForm">
    <input id="ptext" placeholder="Popup Text" required>
    <label><input type="checkbox" id="penabled"> Enabled</label>
    <button type="submit">Add Popup</button>
  </form>
  <h3>Popups</h3>
  <div id="popupList"></div>

<script>
// ✅ Dynamic API base
const API_BASE = window.location.hostname === "localhost"
  ? "http://localhost:5000"
  : "https://jobsarena.onrender.com";

// ===== Admin guard =====
const session = JSON.parse(localStorage.getItem("jb_session") || "null");
if (!session || !session.user || session.user.role !== "admin") {
  alert("Admin only — please login as admin");
  window.location = "login.html";
}
const token = session.token;

// ✅ Helper fetch wrapper
async function apiFetch(endpoint, options = {}) {
  const res = await fetch(`${API_BASE}/api/${endpoint}`, {
    ...options,
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${token}`,
      ...(options.headers || {})
    }
  });
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(err.message || `Request failed (${res.status})`);
  }
  return res.json();
}

// ===== Add Job =====
document.getElementById("jobForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  try {
    await apiFetch("jobs", {
      method: "POST",
      body: JSON.stringify({
        title: jt.value.trim(),
        company: jc.value.trim(),
        category: jcat.value.trim(),
        location: jloc.value.trim(),
        description: jdesc.value.trim()
      })
    });
    alert("✅ Job added successfully");
    e.target.reset();
    renderJobs();
  } catch (err) { alert("❌ " + err.message); }
});

// ===== Add Member =====
document.getElementById("memberForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  try {
    await apiFetch("members", {
      method: "POST",
      body: JSON.stringify({
        name: mname.value.trim(),
        role: mrole.value.trim()
      })
    });
    alert("✅ Member added successfully");
    e.target.reset();
    renderMembers();
  } catch (err) { alert("❌ " + err.message); }
});

// ===== Add Offer =====
document.getElementById("offerForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  try {
    await apiFetch("offers", {
      method: "POST",
      body: JSON.stringify({
        title: ot.value.trim(),
        price: op.value.trim(),
        description: od.value.trim()
      })
    });
    alert("✅ Offer added successfully");
    e.target.reset();
    renderOffers();
  } catch (err) { alert("❌ " + err.message); }
});

// ===== Add Popup =====
document.getElementById("popupForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  try {
    await apiFetch("popups", {
      method: "POST",
      body: JSON.stringify({
        text: ptext.value.trim(),
        enabled: penabled.checked
      })
    });
    alert("✅ Popup added successfully");
    e.target.reset();
    renderPopups();
  } catch (err) { alert("❌ " + err.message); }
});

// ===== Render Data =====
async function renderJobs() {
  try {
    const jobs = await apiFetch("jobs");
    jobsList.innerHTML = jobs.map(j =>
      `<div class="list-item"><span>${j.title} @ ${j.company}</span></div>`
    ).join("") || "<p>No jobs yet.</p>";
  } catch (err) { jobsList.innerHTML = "<p>Error loading jobs</p>"; }
}
async function renderMembers() {
  try {
    const members = await apiFetch("members");
    membersList.innerHTML = members.map(m =>
      `<div class="list-item"><span>${m.name} (${m.role})</span></div>`
    ).join("") || "<p>No members yet.</p>";
  } catch (err) { membersList.innerHTML = "<p>Error loading members</p>"; }
}
async function renderOffers() {
  try {
    const offers = await apiFetch("offers");
    offersList.innerHTML = offers.map(o =>
      `<div class="list-item"><span>${o.title} — $${o.price}</span></div>`
    ).join("") || "<p>No offers yet.</p>";
  } catch (err) { offersList.innerHTML = "<p>Error loading offers</p>"; }
}
async function renderPopups() {
  try {
    const popups = await apiFetch("popups");
    popupList.innerHTML = popups.map(p =>
      `<div class="list-item"><span>${p.text} ${p.enabled?'✅':''}</span></div>`
    ).join("") || "<p>No popups yet.</p>";
  } catch (err) { popupList.innerHTML = "<p>Error loading popups</p>"; }
}

// ===== Init =====
renderJobs();
renderMembers();
renderOffers();
renderPopups();
</script>
</body>
</html>





