<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard - JobsArena</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    h1 { color: #222; }
    #welcome { margin-bottom: 15px; font-weight: bold; }
    .container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
    .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .card h2 { margin-top: 0; font-size: 20px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
    ul { padding-left: 20px; }
    li { margin-bottom: 8px; }
    .empty { color: gray; font-style: italic; }
    button { margin-top: 15px; padding: 8px 15px; border: none; border-radius: 6px; background: crimson; color: white; cursor: pointer; }
    button:hover { background: darkred; }
  </style>
</head>
<body>
  <h1>User Dashboard</h1>
  <div id="welcome"></div>
  <button id="logoutBtn">Logout</button>

  <div class="container">
    <div class="card">
      <h2>Available Jobs</h2>
      <ul id="jobs-list"></ul>
    </div>
    <div class="card">
      <h2>Members</h2>
      <ul id="members-list"></ul>
    </div>
    <div class="card">
      <h2>Offers</h2>
      <ul id="offers-list"></ul>
    </div>
  </div>

  <script>
    const API_BASE = "https://jobsarena.onrender.com"; // âœ… your backend URL
    const session = JSON.parse(localStorage.getItem("jb_session") || "null");

    if (!session) {
      alert("You must log in first!");
      window.location.href = "login.html";
    }

    document.getElementById("welcome").textContent = `Welcome, ${session.name} (${session.role})`;

    // ===== Logout =====
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("jb_session");
      window.location.href = "index.html";
    });

    // Helper function to render list
    function renderList(elementId, data, formatter) {
      const container = document.getElementById(elementId);
      if (!data || data.length === 0) {
        container.innerHTML = "<li class='empty'>No records available</li>";
      } else {
        container.innerHTML = "";
        data.forEach(item => {
          const li = document.createElement("li");
          li.textContent = formatter(item);
          container.appendChild(li);
        });
      }
    }

    // Fetch Jobs
    fetch(`${API_BASE}/api/jobs`)
      .then(res => res.json())
      .then(data => renderList("jobs-list", data, job => `${job.title} - ${job.company}`))
      .catch(err => console.error("Error fetching jobs:", err));

    // Fetch Members
    fetch(`${API_BASE}/api/members`)
      .then(res => res.json())
      .then(data => renderList("members-list", data, member => `${member.name} (${member.email})`))
      .catch(err => console.error("Error fetching members:", err));

    // Fetch Offers
    fetch(`${API_BASE}/api/offers`)
      .then(res => res.json())
      .then(data => renderList("offers-list", data, offer => `${offer.title} - ${offer.description}`))
      .catch(err => console.error("Error fetching offers:", err));
  </script>
</body>
</html>



